<html>

<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tippy.js/6.3.7/themes/light.min.css"
        integrity="sha512-zpbTFOStBclqD3+SaV5Uz1WAKh9d2/vOtaFYpSLkosymyJKnO+M4vu2CK2U4ZjkRCJ7+RvLnISpNrCfJki5JXA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        #clue {
            font-family: monospace;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="row">
            <div class="col-11">
                <h6><i>Jeopardy!</i> Board</h6>
                <table id="jeopardy">

                </table>
            </div>
            <div class="col-1">
                <table id="players">

                </table>
            </div>
        </div>
        <div class="row">
            <div class="col-10">
                <h6>Clue</h6>
                <p><i>Clue: </i><span id="clue"></span></p>
                <p><i>Answer: </i><span id="answer"></span></p>
            </div>
            <div class="col-2">
                <button onclick="clearClue();">Clear Clue (c)</button>
            </div>
        </div>
        <div class="row">
            <div class="col-10">
                <h6>Buzzer</h6>
                <p><i>State: </i><span id="buzzerState"></span></p>
                <p><i>Player: </i><span id="buzzerPlayer"></span></p>
                <button onclick="adjudicateRight();">Right (->)</button>
                <button onclick="adjudicateWrong();">Wrong (<-)</button>
            </div>
            <div class="col-2">
                <button onclick="armBuzzer();">Arm (a)</button>
                <button onclick="resetBuzzer();">Reset (r)</button>
            </div>
        </div>

    </div>

    <!-- socket.io -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.6.1/socket.io.min.js"></script>
    <script src="https://unpkg.com/@popperjs/core@2"></script>
    <script src="https://unpkg.com/tippy.js@6"></script>
    <script src="common.js"></script>
    <script>
        function setBuzzerState(state) {
            socket.emit("buzzerstate", { state: state });
        }

        function armBuzzer() {
            setBuzzerState("armed");
        }

        function resetBuzzer() {
            setBuzzerState("not-armed");
        }

        function adjudicateRight() {
            socket.emit("adjudicate", { right: true });
        }

        function adjudicateWrong() {
            socket.emit("adjudicate", { right: false });
        }
        function renderPicked(data) {
            for (var pair in data) {
                var pairData = data[pair];
                var element = getClueElement(document.getElementById("jeopardy"), pairData[0], pairData[1]);
                element.children[0].style.color = "#ff0000";
                console.log(element);
            }
        }

        function clearClue() {
            socket.emit("clearclue");
        }
        var socket = io();
        var game;
        socket.on("game", (data) => {
            renderBoard(data, document.getElementById("jeopardy"), true, (k1, k2) => {
                socket.emit("clueselected", { k1: k1, k2: k2 });
            });
            game = data;
        });

        socket.on("scores", (data) => {
            console.log(data);
        });


        socket.on("scores", (data) => {
            var table = document.getElementById("players");
            emptyElement(table);
            // for each player...
            table.innerHTML = "<tr><th>Name</th><th>Score</th></tr>"
            for (var i = 0; i < data.length; i++) {
                var player = data[i];
                // create a row
                var row = document.createElement("tr");
                // create a cell for the name
                var nameCell = document.createElement("td");
                nameCell.innerHTML = player.name;
                row.appendChild(nameCell);
                // create a cell for the score
                var scoreCell = document.createElement("td");
                scoreCell.innerHTML = player.score;
                row.appendChild(scoreCell);

                // remove button
                var removeCell = document.createElement("td");
                var removeButton = document.createElement("button");
                removeButton.innerHTML = "X";
                removeButton.addEventListener("click", () => {
                    socket.emit("removeplayer", { id: player.id });
                });
                removeCell.appendChild(removeButton);
                row.appendChild(removeCell);

                // modify score
                var modifyCell = document.createElement("td");
                var modifyButton = document.createElement("button");
                modifyButton.innerHTML = "+";
                modifyButton.addEventListener("click", () => {
                    var input = prompt("Enter amount to modify score by");
                    if (input.charAt(0) == "-" || input.charAt == "+") {
                        socket.emit("modifyscore", { id: player.id, amount: new Number(input) });
                    } else {
                        socket.emit("setscore", { id: player.id, amount: new Number(input) });
                    }

                });
                modifyCell.appendChild(modifyButton);
                row.appendChild(modifyCell);


                // append the row to the table
                table.appendChild(row);
            }
        });

        socket.on("picked", (data) => {
            renderPicked(data);
        });

        socket.on("clue", (data) => {
            document.getElementById("clue").innerHTML = data.text;
            document.getElementById("answer").innerHTML = data.answer;
        });

        socket.on("clearclue", () => {
            document.getElementById("clue").innerHTML = "";
            document.getElementById("answer").innerHTML = "";
        });

        socket.on("buzzerstate", (data) => {
            document.getElementById("buzzerState").innerHTML = data.state;
            document.getElementById("buzzerPlayer").innerHTML = data.player;
        });

        

        socket.emit("setup", { type: "host", roomid: 1 });

    </script>

</body>

</html>